# 移植方案 - 小步快跑版

## 📖 文档说明

- **本文档**：提供任务概览和验证点
- **`DETAILED_TASK_GUIDE.md`**：提供**超详细**的逐行代码级执行步骤
  - ✅ 每个任务的具体操作步骤
  - ✅ 完整代码示例（可直接复制）
  - ✅ Unity源码参考位置
  - ✅ 验证方法和常见问题处理

**建议工作流程**：
1. 在本文档查看任务概览
2. 在 `DETAILED_TASK_GUIDE.md` 查看详细步骤
3. 按照详细步骤执行任务
4. 完成后更新 `PROGRESS.md`

## 原则

- **垂直切片**：每个任务都包含数据+逻辑+场景，立即可见效果
- **单一职责**：一个任务只做一件事
- **可验证**：每完成一步都能运行看到结果

---

## 架构说明

**Oops 框架采用单场景架构**：
- 只有一个主场景 `main_master.scene`
- 所有"场景"都是 UI 预制体，通过 `oops.gui.open(UIID.xxx)` 切换
- 使用 GUI 层级系统管理 UI 显示顺序

```
主场景(main_master.scene)
    └── GUI层级
        ├── LayerGame    ← Logo、Loading、Farm、Factory 等全屏界面
        ├── LayerUI      ← 主界面UI
        ├── LayerPopUp   ← 弹窗
        ├── LayerDialog  ← 对话框
        └── ...
```

---

## 游戏流程

```
Logo(UI) → Loading(UI) → Menu(UI) → Farm(UI)/Factory(UI)/Store(UI)/Town(UI)
```

---

## 第零部分：启动流程

### Sprint 0：Logo 和 Loading

| # | 任务 | 验证点 |
|---|------|--------|
| 0.1 | 创建 Logo 预制体，注册到 UIID | 能显示 Logo 界面 |
| 0.2 | Logo 界面添加 Logo 图片 | 看到 Logo 图 |
| 0.3 | Logo 停留 2 秒后关闭，显示 Loading | 自动切换 |
| 0.4 | 完善 Loading 预制体界面 | 看到加载进度条 |
| 0.5 | Loading 显示加载百分比文字 | 看到 0%→100% |
| 0.6 | Loading 完成后显示主菜单 | 自动跳转 |

---

### Sprint 0.5：主菜单

| # | 任务 | 验证点 |
|---|------|--------|
| 0.7 | 创建 Menu 预制体，注册到 UIID | 能显示主菜单 |
| 0.8 | 添加"开始游戏"按钮 | 按钮可见可点 |
| 0.9 | 添加游戏标题/背景 | 菜单界面美观 |
| 0.10 | 点击开始进入农场界面 | 能进入游戏 |

---

## 第一部分：农场模块

### Sprint 1：最小农场场景

| # | 任务 | 验证点 |
|---|------|--------|
| 1.1 | 创建 Farm 场景，添加相机和背景色 | 能进入空的农场场景 |
| 1.2 | 添加一个田地节点（空Node） | 场景中能看到田地位置 |
| 1.3 | 给田地添加 Sprite 显示土地图片 | 能看到一块土地 |
| 1.4 | 创建 FieldComp 组件绑定到田地 | 控制台打印田地信息 |
| 1.5 | 实现点击田地响应 | 点击土地，控制台输出 |

---

### Sprint 2：种植功能

| # | 任务 | 验证点 |
|---|------|--------|
| 2.1 | 创建作物数据类 CropData（id, name, growTime） | 能创建作物数据 |
| 2.2 | 点击田地弹出种植选择（简单列表） | 点击出现作物选项 |
| 2.3 | 选择作物后，田地显示种子图片 | 看到种子种下去了 |
| 2.4 | 田地状态切换（空→已种植） | 状态正确变化 |

---

### Sprint 3：生长系统

| # | 任务 | 验证点 |
|---|------|--------|
| 3.1 | 添加生长时间计时器 | 控制台打印剩余时间 |
| 3.2 | 田地上显示生长进度条 | 能看到进度条增长 |
| 3.3 | 生长阶段切换（种子→幼苗→成熟） | 图片随阶段变化 |
| 3.4 | 成熟状态标识（加个图标或动画） | 一眼看出可以收获 |

---

### Sprint 4：收获功能

| # | 任务 | 验证点 |
|---|------|--------|
| 4.1 | 点击成熟作物执行收获 | 点击后作物消失 |
| 4.2 | 收获数量计算 | 控制台显示获得数量 |
| 4.3 | 收获动画/特效（简单的飞出效果） | 有视觉反馈 |
| 4.4 | 田地重置为空地状态 | 可以重新种植 |

---

### Sprint 5：多田地

| # | 任务 | 验证点 |
|---|------|--------|
| 5.1 | 场景中添加 3x3 九块田地 | 看到 9 块地 |
| 5.2 | 田地数据用数组管理 | 每块地独立状态 |
| 5.3 | 创建田地预制体 Prefab | 方便复用 |

---

### Sprint 6：农场 UI

| # | 任务 | 验证点 |
|---|------|--------|
| 6.1 | 顶部显示金钱数量 | 看到金钱 UI |
| 6.2 | 种植扣除金钱 | 种植后钱减少 |
| 6.3 | 收获增加金钱 | 收获后钱增加 |
| 6.4 | 金钱不足提示 | 钱不够时有提示 |

---

### Sprint 7：配置驱动

| # | 任务 | 验证点 |
|---|------|--------|
| 7.1 | 创建作物配置 JSON | 作物数据从配置读取 |
| 7.2 | 创建田地配置 JSON | 田地数量/价格可配置 |
| 7.3 | 从 Unity XML 转换第一关配置 | 加载关卡 1 的农场数据 |

---

## 第二部分：工厂模块

### Sprint 8：最小工厂场景

| # | 任务 | 验证点 |
|---|------|--------|
| 8.1 | 创建 Factory 场景 | 能进入工厂场景 |
| 8.2 | 添加一台机器节点 | 看到机器 |
| 8.3 | 创建 MachineComp 组件 | 控制台打印机器信息 |
| 8.4 | 点击机器响应 | 点击有反应 |

---

### Sprint 9：生产功能

| # | 任务 | 验证点 |
|---|------|--------|
| 9.1 | 创建产品数据（原料→产品） | 产品配置 |
| 9.2 | 点击机器选择要生产的产品 | 弹出产品列表 |
| 9.3 | 检查原料是否足够 | 原料不足有提示 |
| 9.4 | 开始生产，显示进度 | 看到生产进度条 |
| 9.5 | 生产完成，获得产品 | 产品数量增加 |

---

### Sprint 10：库存系统

| # | 任务 | 验证点 |
|---|------|--------|
| 10.1 | 创建库存数据类 | 管理原料和产品 |
| 10.2 | 显示库存 UI | 看到当前库存 |
| 10.3 | 农场收获物进入库存 | 农场和工厂数据联通 |

---

## 第三部分：场景切换

### Sprint 11：导航系统

| # | 任务 | 验证点 |
|---|------|--------|
| 11.1 | 农场场景添加"去工厂"按钮 | 按钮可见 |
| 11.2 | 点击按钮切换到工厂场景 | 成功切换 |
| 11.3 | 工厂添加"回农场"按钮 | 能返回农场 |
| 11.4 | 场景切换保持数据 | 数据不丢失 |
| 11.5 | 添加切换过渡动画 | 切换更流畅 |

---

## 第四部分：商店模块

### Sprint 12：最小商店场景

| # | 任务 | 验证点 |
|---|------|--------|
| 12.1 | 创建 Store 场景 | 能进入商店 |
| 12.2 | 添加货架节点 | 看到货架 |
| 12.3 | 货架显示产品 | 看到可售商品 |
| 12.4 | 点击货架出售产品 | 产品卖出，获得金钱 |

---

## 第五部分：城镇模块

### Sprint 13：最小城镇场景

| # | 任务 | 验证点 |
|---|------|--------|
| 13.1 | 创建 Town 场景 | 能进入城镇 |
| 13.2 | 添加员工楼建筑 | 看到建筑 |
| 13.3 | 点击建筑查看员工 | 弹出员工列表 |
| 13.4 | 雇佣员工功能 | 花钱雇人 |

---

## 第六部分：关卡系统

### Sprint 14：关卡流程

| # | 任务 | 验证点 |
|---|------|--------|
| 14.1 | 创建关卡目标数据 | 读取目标配置 |
| 14.2 | 显示当前目标 UI | 看到要完成什么 |
| 14.3 | 目标完成检测 | 达成目标有提示 |
| 14.4 | 关卡结算面板 | 显示星级评价 |

---

## 立即开始的任务

### Sprint 1: 配置系统

**任务 1.1.1：创建配置管理器基类**

- 📖 **详细步骤**: 见 `DETAILED_TASK_GUIDE.md` 任务 1.1.1
- ✅ **验证点**: 代码可以编译，ConfigManager 类可以正常导入

**任务 1.1.2：创建关卡配置加载器**

- 📖 **详细步骤**: 见 `DETAILED_TASK_GUIDE.md` 任务 1.1.2
- ✅ **验证点**: 能成功加载 mission_1.json 配置

**任务 1.1.3：将 XML 关卡配置转为 JSON**

- 📖 **详细步骤**: 见 `DETAILED_TASK_GUIDE.md` 任务 1.1.3
- ✅ **验证点**: 50个关卡配置全部转换成功，数据完整

---

## 已完成任务示例

**任务 0.1：创建 Logo 预制体，注册到 UIID** ✅

```
步骤：
1. 在 resources/gui/logo/ 创建 Logo.prefab 预制体
2. 在 GameUIConfig.ts 中添加 UIID.Logo
3. 注册预制体路径和层级（LayerGame）
4. 修改 InitRes.ts，启动时先显示 Logo
```

**验证点**：运行游戏能看到 Logo 界面
